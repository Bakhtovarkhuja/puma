define(["jquery","jquery/validate","validation","mage/mage","browser","domReady!"],function($){"use strict";return{init:function(){this.cache();this.events();this.checkAutocomplete();this.validateNumbers();if(document.readyState==="complete"){this.checkInputsLength();}else{window.addEventListener("load",e=>{this.checkInputsLength();});}},cache:function(){this.$document=$(document);this.$body=$("body");this.input=".form__input-text";this.textArea=".form__textarea-text";this.inputNumbers=".js-validate-number";this.elemWithDatepicker="._has-datepicker";this.select=".js-validate-select";this.radio=".form__radio";this.checkbox=".form__checkbox";},events:function(){var textField=[this.input,this.textArea].join(", ");var selectField=[this.select,this.radio,this.checkbox].join(", ");this.$document.off("blur.form focus.form paste.form",textField).on("blur.form focus.form paste.form",textField,function(event){if(event.type==="blur"||event.type==="paste"||event.type==="focusout"){this.onFocusOut(event);}else if(event.type==="focus"||event.type==="focusin"){this.onFocusIn(event);}}.bind(this));this.$document.off("change.form, keyup.form, input.form",textField).on("change.form, keyup.form, input.form",textField,this.onTextChanged.bind(this));this.$document.off("change.form",selectField).on("change.form",selectField,this.onTextChanged.bind(this));this.$document.off("update-input-labels").on("update-input-labels",this.checkInputsLength.bind(this));},onTextChanged:function(event){var $elem=$(event.target);var $form=$elem.closest("form");this.checkValidation($elem);this.manageSubmitBtn($form);this.errorDistance($elem);},checkInputLabel($elem){if($elem.is("input:-webkit-autofill")){const parent=$elem.closest("div")[0];if(parent){setTimeout(()=>{const error=parent.querySelector("div.mage-error");if(error){error.classList.add("_static-error");}},0);}}
const el=$elem[0];if(el&&el.value||$elem.is("input:-webkit-autofill")){el.classList.remove("_empty");el.classList.add("_fill");}else{el.classList.remove("_fill");el.classList.add("_empty");}},checkInputsLength:function(){$("body").find([this.input,this.textArea,this.select].join(",")).each(function(index,elem){this.checkInputLabel($(elem));this.checkValidation($(elem),1);this.manageSubmitBtn($(elem).closest("form"));}.bind(this));},onFocusIn:function(event){$(event.currentTarget).addClass("_fill");this.checkValueLength($(event.currentTarget));if(this.$body.hasClass("mobile")){setTimeout(function(){$(event.currentTarget).addClass("_fill");},0);}},onFocusOut:function(event){var $elem=$(event.currentTarget);var hasDatepicker=Boolean($elem.closest(this.elemWithDatepicker).length)&&!$elem.data("reject-datepicker");var isDatepickerEnabled=hasDatepicker?!$(this.elemWithDatepicker).datepicker("isDisabled"):false;this.checkValueLength($(event.currentTarget));setTimeout(function(){if(!$elem.val().length){$elem.removeClass("_fill");}
this.checkValidation($elem);}.bind(this),isDatepickerEnabled?250:0);},checkValidation:function($elem,load){var condition=load?$elem.hasClass("_fill")&&$.validator.validateSingleElement($elem):$.validator.validateSingleElement($elem);var $parent=$elem.parent();if(!$elem.hasClass("required-entry")){this.checkValueLength($elem);}
if($elem.data("validate")||$elem.hasClass("required-entry")){this.changeParentClasses($parent,condition);$(document).trigger("check-element-validation");}},changeParentClasses($parent,condition){if(condition){$parent.removeClass("invalid").addClass("valid");}else{$parent.addClass("invalid").removeClass("valid");}},manageSubmitBtn:function($form){const $submitBtn=$form.find("input[type=\"submit\"], button[type=\"submit\"]");if($submitBtn.length&&$form.data("validator")){const validStatus=$form.validate().checkForm();$submitBtn.toggleClass("_disabled",!validStatus);}},checkAutocomplete(){const $input=$(this.input);if(!$.browser.webkit){return;}
for(let i=0;i<$input.length;i+=1){if($input.eq(i).is(":-webkit-autofill")||$input.val().length>0){$input.eq(i).addClass("_fill");$input.eq(i).removeClass("_empty");}}},validateNumbers:function(){$(this.$body).on("keyup keypress",this.inputNumbers,function(event){var letters=" 1234567890";return letters.indexOf(String.fromCharCode(event.which))!==-1;});},errorDistance:function($elem){var $error=$elem.closest("div").find("div.mage-error");if($error.innerHeight()>parseInt($elem.closest(".form__row-text").css("margin-bottom"),10)){$error.addClass("_static-error");}},checkValueLength:function($elem){const $parent=$elem.parent();$elem[($elem.val()&&$elem.val().length)?"removeClass":"addClass"]("_empty");if($elem.val()!==null&&!($elem.val()&&$elem.val().length)){$parent.removeClass("valid");$elem.removeClass("valid");}},};});