define(["getEsRecommendations","renderProductCarousel","helper.intersectionObserver","productImpressionEvent"],function(getEsRecommendations,renderProductCarousel,intersectionObserver,productImpressionEvent){return function(anchorDomElement,options={}){if(window.customer?.is_ambassador||window.$currentCustomer?.is_ambassador){return;}
if(!anchorDomElement){console.error("%cError getting eSputnik recommendations anchor: ","background: #000; color: #c30677;",anchorDomElement);return;}
const{blockTitle,additionalGetParameters}=options;intersectionObserver({domElements:[anchorDomElement],observerCallback:observerRecommendationRequestCb,observerOptions:{threshold:1,rootMargin:`400px 0px 400px 0px`}});function observerRecommendationRequestCb(entries,observer){entries.forEach(entry=>{if(entry.intersectionRatio===1){renderEsRecommendation();observer.unobserve(entry.target);}});}
function renderEsRecommendation(){getEsRecommendations(options).then(data=>{if(data.length){renderProductCarousel({anchorDomElement,productsList:data,blockTitle,additionalGetParameters,});const domElements=anchorDomElement.querySelectorAll("[data-observer-container]");if(domElements.length){intersectionObserver({domElements,observerCallback:observerProductImpressionsCallback,});}}});}
function observerProductImpressionsCallback(entries,observer){let impressionProducts=[];entries.forEach(entry=>{if(entry.intersectionRatio>0.5){const products=entry.target.querySelectorAll("[data-observer-recommendation]");products.forEach(product=>{impressionProducts.push({"product_id":product.dataset.esId,"container_type":product.dataset.esContainerType,});});observer.unobserve(entry.target);}});if(impressionProducts.length){productImpressionEvent(impressionProducts);}}};});