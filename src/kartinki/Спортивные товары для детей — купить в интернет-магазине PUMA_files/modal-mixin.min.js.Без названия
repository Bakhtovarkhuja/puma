define(['jquery','matchSize'],function($,matchSize){'use strict'
return function(){$.widget('mage.modal',$.mage.modal,{pageModalClass:'_opened-modal',html:'html',innerWrap:'.modal-inner-wrap',scrollPageTop:0,_renderModal:function(){this._super()
this.modal.on('tap',this.onModalClick.bind(this))},_createOverlay:function(){var events,outerClickHandler=this.options.outerClickHandler||this.closeModal
this.overlay=$('.'+this.options.overlayClass)
if(!this.overlay.length){this.addPageFixed()
$(this.options.appendTo).addClass(this.options.parentModalClass)
this.overlay=$('<div></div>').addClass(this.options.overlayClass).appendTo(this.modalWrapper)}
events=$._data(this.overlay.get(0),'events')
events?(this.prevOverlayHandler=events.click[0].handler):false
this.options.clickableOverlay?this.overlay.unbind().on('click',outerClickHandler):false},_destroyOverlay:function(){if(this._getVisibleCount()){this.overlay.unbind().on('click',this.prevOverlayHandler)}else{this.removePageFixed()
$(this.options.appendTo).removeClass(this.options.parentModalClass)
this.overlay.remove()
this.overlay=null}
this.modal.trigger('modal:close')},addPageFixed:function(){this.scrollPageTop=$(document).scrollTop()
this.togglePageClass(true)
$(this.html).css('top',-this.scrollPageTop)},removePageFixed:function(){this.togglePageClass(false)
if(matchSize().desktop){return}
$(this.html).css('top',0)
$(document).scrollTop(this.scrollPageTop)},togglePageClass:function(value){if(value){$(this.html).addClass(this.pageModalClass)}else{$(this.html).removeClass(this.pageModalClass)}},onModalClick:function(ev){var $target=$(ev.target)
if(!$target.closest(this.innerWrap).length&&this.options.clickableOverlay){this.closeModal()}}})
return $.mage.modal}})