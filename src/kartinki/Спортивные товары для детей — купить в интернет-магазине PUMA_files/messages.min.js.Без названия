define(['jquery','uiComponent','Magento_Customer/js/customer-data','underscore','Magento_Customer/js/section-config','jquery/jquery-storageapi'],function($,Component,customerData,_,sectionConfig){'use strict'
return Component.extend({defaults:{cookieMessages:[],messages:[]},initialize:function(){var $messages=$('.page.messages'),timeout
this._super()
this.cookieMessages=$.cookieStorage.get('mage-messages')
this.messages=customerData.get('messages').extend({disposableCustomerData:'messages'})
if(!_.isEmpty(this.messages().messages)){customerData.set('messages',{})}
$.cookieStorage.set('mage-messages','')
$(document).off('ajaxComplete').on('ajaxComplete',function(event,xhr,settings){var sections,redirects
if(settings.type.match(/post|put|delete/i)){sections=sectionConfig.getAffectedSections(settings.url)
sections.splice(sections.indexOf('messages'),1)
if(sections.length){customerData.invalidate(sections)
redirects=['redirect','backUrl']
if(_.isObject(xhr.responseJSON)&&!_.isEmpty(_.pick(xhr.responseJSON,redirects))){return}
customerData.reload(sections,true)}}}).on('update-messages',function(event,messages){$messages.find('.message').remove()
this.messages(messages())
$(document).trigger('show-messages')}.bind(this))
$(document).on('show-messages',function(){clearTimeout(timeout)
$messages.addClass('_show')
timeout=setTimeout(function(){$messages.removeClass('_show')},5000)})
$(document).trigger('show-messages')}})})