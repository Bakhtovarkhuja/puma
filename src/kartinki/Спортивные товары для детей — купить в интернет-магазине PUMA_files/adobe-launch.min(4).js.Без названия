define(["uiComponent","uiRegistry","Magento_Ui/js/lib/core/storage/local","lodash"],function(Component,registry,storage,_){return Component.extend({onFilter:function(payload){window.pageData=window.pageData||{};if(payload.filters&&window.pageData.categoryRefinements){this.clearRefinements("filter");}
if(payload.sorting&&window.pageData.categoryRefinements){this.clearRefinements("sort");}
if(payload.filters){this.pushFilters(payload);}
if(payload.sorting){this.pushSorting(payload);}},onProductItemClick:function(data){const parent=registry.get(this.parentName);const mapper=parent.objectMapper.adobe_launch;const lazyData={clickedItem:{}};_.each(mapper.product,function(val,key){lazyData.clickedItem[key]=data[val];});storage.set("analytics.adobe-launch",lazyData);},pushFilters:function(payload){payload.filters.forEach(function(filter){this.pushRefinementTrackEvent({type:"filter",name:filter.code,valueID:filter.valueId,valueName:filter.valueName});}.bind(this));},clearRefinements:function(type){var keysToRemove=[];_.each(window.pageData.categoryRefinements,function(element,index){if(element.type===type){keysToRemove.push(index);}});window.pageData.categoryRefinements=window.pageData.categoryRefinements.filter(function(value,index){return keysToRemove.indexOf(index)===-1;});},pushRefinementTrackEvent:function(data){this.pushTrackEvent({"event":[this.getDefaultEventDescription()],categoryRefinements:data});this.updateCategoryRefinements(data);},updateCategoryRefinements:function(data){window.pageData.categoryRefinements=window.pageData.categoryRefinements||[];window.pageData.categoryRefinements.push(data);const updatePageDataEvent=new CustomEvent("pageData.update",{detail:{data:JSON.parse(JSON.stringify(window.pageData)),updateType:"catalog.update"}});window.document.dispatchEvent(updatePageDataEvent);},pushTrackEvent:function(eventData){window.pageDataTrack=window.pageDataTrack||[];},getDefaultEventDescription:function(){return{name:"category_refinement",type:"refinement"};},pushSorting:function(payload){this.pushRefinementTrackEvent({type:"sort",ascending:payload.sorting.dir==="asc",name:payload.sorting.name,results:payload.productsCount});}});});