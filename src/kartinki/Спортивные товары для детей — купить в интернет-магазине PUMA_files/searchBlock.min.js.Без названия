define(['debounce',],function(debounce,){return function(options){const{filterType,maxSearchCountToShow}=options;if(!filterType){console.error('Not set filterType');return;}
const filterBlock=document.querySelector(`.filter-block[data-filter-type="${ filterType }"]`);if(!filterBlock){console.error('No filterType block found');return;}
const searchInput=filterBlock.querySelector('[data-filter-search-input]');const searchCloseIcon=filterBlock.querySelector('[data-filter-search-close-icon]');const filterItems=filterBlock.querySelectorAll('[data-search-text]');const showAllItems=filterBlock.querySelector('[data-show-all-filter-options]');const hideAllItems=filterBlock.querySelector('[data-hide-all-filter-options]');const listBlock=filterBlock.querySelector('.filter-items');const localstorageKeyName='$searchFilters';let currentValue='';searchInput.addEventListener('input',debounce((e)=>{changeSearchInput(e);},100));searchCloseIcon.addEventListener('click',clickClearSearchHandler);showAllItems.addEventListener('click',showAllClickHandler);hideAllItems.addEventListener('click',hideAllClickHandler);setSavedState();function showAllClickHandler(){filterItems.forEach(item=>{item.classList.remove('hidden');});showAllItems.classList.add('hidden');hideAllItems.classList.remove('hidden');saveState({isOpened:true});}
function hideAllClickHandler(){const maxCountToShow=+listBlock?.dataset?.maxShowCount||5;Array.from(filterItems).slice(maxCountToShow).forEach(item=>{item.classList.add('hidden');});hideAllItems.classList.add('hidden');showAllItems.classList.remove('hidden');saveState({isOpened:false});}
function changeSearchInput(e){currentValue=e.target.value;searchCloseIcon.classList?.[currentValue?'remove':'add']('hidden');showAllItems.classList?.[currentValue?'add':'remove']('hidden-search');hideAllItems.classList?.[currentValue?'add':'remove']('hidden-search');searchHandler(currentValue,maxSearchCountToShow);saveState({input:currentValue});}
function clickClearSearchHandler(e){searchInput.value='';searchInput.dispatchEvent(new Event('input'));searchCloseIcon.classList.add('hidden');}
function searchHandler(value,maxSearchCountToShow){let searchResultCount=0;filterItems.forEach(item=>{const itemText=item.dataset.searchText||'';const regex=new RegExp(value,'gi');if(!value){item.classList.remove('search-hide','search-show');}else if(regex.test(itemText)&&searchResultCount<maxSearchCountToShow){searchResultCount++;item.classList.add('search-show');item.classList.remove('search-hide');}else{item.classList.remove('search-show');item.classList.add('search-hide');}});}
function saveState(state={}){const prevObjValue=window?.[localstorageKeyName]||'{}';window[localstorageKeyName]={[window.location.pathname]:Object.assign(prevObjValue[window.location.pathname]||{},{[filterType]:Object.assign(prevObjValue[window.location.pathname]?.[filterType]||{},state)})};}
function setSavedState(){const prevObjValue=window?.[localstorageKeyName]||'{}';if(!Object.keys(prevObjValue).length){return;}
if(!prevObjValue?.[window.location.pathname]?.[filterType]){return;}
if(prevObjValue?.[window.location.pathname]?.[filterType].hasOwnProperty('input')){setLastSearchState(prevObjValue?.[window.location.pathname]?.[filterType]?.input);}
if(prevObjValue?.[window.location.pathname]?.[filterType].hasOwnProperty('isOpened')){setShowAllState(prevObjValue?.[window.location.pathname]?.[filterType]?.isOpened);}}
function setLastSearchState(value){searchInput.value=value;searchInput.dispatchEvent(new Event('input'));}
function setShowAllState(isOpened){if(isOpened){showAllClickHandler();}else{hideAllClickHandler();}}};});