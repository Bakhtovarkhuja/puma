define(['jquery','js/wishlist/loginUserHandler','commonAnalyticHandler','js/socialTrigger/customSocialButtons','helper.onPageLoad','helper.intersectionObserver','js/gga/ga4Custom/newsletterImpression','js/gga/ga4Custom/logout','js/gga/ga4Custom/scroll','js/helper/debounce','mage/translate',],function($,wishlistLoginUserHandler,commonAnalyticHandler,customSocialButtons,onPageLoad,intersectionObserver,newsletterImpression,logoutGA4Event,scrollGA4Event,debounce,$t,){window.$t=$t;customSocialButtons();addEventListener("scroll",debounce(scrollGA4Event,300));window.$ambasadorPrice=1;if(location.hash){const anchorEl=document.querySelector(`[data-scroll-anchor="${ location.hash.slice(1) }"]`);if(anchorEl){scrollToAnchorElem();}
function scrollToAnchorElem(offsetCorrection=20){const headerRoot=document.querySelector("puma-header");const headerBar=headerRoot&&headerRoot.shadowRoot&&headerRoot.shadowRoot.querySelector(".puma-header__bar");const computedOffset=anchorEl.offsetTop-(headerRoot&&headerBar&&headerBar.offsetHeight?headerBar.offsetHeight:68)-offsetCorrection;window.scrollTo({top:computedOffset,left:0,behavior:"smooth"});}}
document.body.addEventListener('onCustomerLogin',(e)=>{clearWishlistSessionState();const wishlistProductData=window.sessionStorage.getItem('wishlist_auth_product');if(wishlistProductData){wishlistLoginUserHandler(JSON.parse(wishlistProductData));}});const storageKeyAuthCustomer='$storageKeyAuthCustomer';document.body.addEventListener('onCustomerLogout',(e)=>{clearWishlistSessionState();const logoutUserInfo=JSON.parse(window.localStorage.getItem(storageKeyAuthCustomer)||{});logoutGA4Event({method:window.location.pathname,is_guest:'true',email:logoutUserInfo?.email,custom_user_id:logoutUserInfo?.id,});window.localStorage.setItem(storageKeyAuthCustomer,'');});function clearWishlistSessionState(){window.sessionStorage.setItem('wishlist_prev_state','');}
const localstorageFilterKeyName='searchFilters';const filterStateObj=JSON.parse(window.localStorage.getItem(localstorageFilterKeyName)||'{}');if(Object.keys(filterStateObj).length&&!filterStateObj?.[window.location.pathname]){localStorage.removeItem(localstorageFilterKeyName);}
onPageLoad(()=>{const pageForms=document.querySelectorAll('.subscribe-form.subscribe-page-form');if(!pageForms.length){return;}
const toShowRatio=0.6;const toHideRatio=0.1;const wm=new WeakMap();intersectionObserver({domElements:pageForms,observerCallback:observerFooterSubFormCb,observerOptions:{threshold:toShowRatio,delay:300,}});function observerFooterSubFormCb(entries,observer){entries.forEach(entry=>{let wmEl=wm.get(entry.target);if(typeof wmEl===undefined){wm.set(entry.target,entry.intersectionRatio);if(entry.intersectionRatio>=toShowRatio){wm.set(entry.target,true);newsletterImpression('page form');return;}else{wm.set(entry.target,false);}
return;}
if(entry.intersectionRatio>=toShowRatio&&!wmEl){wm.set(entry.target,true);newsletterImpression('page form');}else if(entry.intersectionRatio<=toHideRatio&&wmEl){wm.set(entry.target,false);}});}});});