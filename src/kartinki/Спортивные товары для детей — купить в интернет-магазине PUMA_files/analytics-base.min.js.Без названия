define(['uiComponent','Magento_Customer/js/customer-data','jquery','mage/cookies','jquery/jquery.parsequery'],function(Component,customerData,$){'use strict';const EVENT_COOKIE='analytics_event_cookie';const $D=$(document);const $miniCart=$('[data-block="minicart"]');return Component.extend({defaults:{trackers:[],colorConfig:{event:'color:change',property:'id'},sizeConfig:{event:'size:change',property:'id'},tracks:{trackers:true}},initialize:function(){this._super();this.events();this.resolveHooksFromCookie();if(this.getPageData('filters')&&this.getPageData('filters').length){this.resolveFilters();}
if(this.getPageData('sorting')){this.resolveSorting();}},events:function(){$(document).on({ajaxComplete:this.onAjaxComplete.bind(this)});if(this.eventMapper.product_click!==null){$D.on('click',this.eventMapper.product_click,this.onProductItemClick.bind(this));}
$miniCart.on('dropdowndialogopen',this.onMinicartOpen.bind(this));$D.on(this.colorConfig.event+'.'+this.name,{cb:'colorChangeHandler',config:this.colorConfig},this.onHandler.bind(this)).on(this.sizeConfig.event+'.'+this.name,{cb:'sizeChangeHandler',config:this.sizeConfig},this.onHandler.bind(this));},onAjaxComplete:function(ev,jqxhr,settings){this.resolveHooksFromCookie();},resolveFilters:function(){this.commitHook('onFilter',{filters:this.getPageData('filters'),productsCount:this.getPageData('products_count')});},resolveSorting:function(){this.commitHook('onFilter',{sorting:this.getPageData('sorting'),productsCount:this.getPageData('products_count')});},resolveHooksFromCookie:function(){const cookieData=$.mage.cookies.get(EVENT_COOKIE);if(cookieData===null){return;}
const actionType=decodeURIComponent(cookieData);switch(actionType){case'cart_add':this.commitHook('onAddToCart');break;case'cart_remove':this.commitHook('onRemoveFromCart');break;case'create_account':this.commitHook('onCreateAccount');break;case'customer_login':this.commitHook('onCustomerLogin');break;case'customer_logout':this.commitHook('onCustomerLogout');break;case'contact_form_submit':this.commitHook('onContactFormSubmit');break;case'vacancy_form_submit':this.commitHook('onVacancyFormSubmit');break;case'applied_filter':this.commitHook('onFilter',{filters:this.getPageData('filters'),sorting:this.getPageData('sorting'),productsCount:this.getPageData('products_count')});break;default:null;}
$.mage.cookies.clear(EVENT_COOKIE);},commitHook:function(name,payload){document.body.dispatchEvent(new CustomEvent(name,{detail:payload,}));function commit(){this.elems().forEach(function(el){el[name]!==undefined&&el[name](payload);});}
if(!this.elems().length){this.elems.subscribe(function(elems){if(elems.length!==this.initChildCount){return;}
commit.call(this);},this);}else{commit.call(this);}},onProductItemClick:function(ev){const $el=$(ev.currentTarget);const id=$el.data('product-sku');const data=this.getProductData(id);const position=$el.parent().index('.'+$el.parent().attr('class'))+1;const category=this.category||(this.getCategoryData()?this.getCategoryData().breadcrumbs:'');if(!data){return;}
if(category){data.category=category;}
if(position){data.position=position;}
this.commitHook('onProductItemClick',data);},onMinicartOpen:function(){this.commitHook('onMinicartOpen');},onHandler:function(ev,data){const eventData=ev.data;this.commitHook(eventData.cb,data[eventData.config.property]);},getParams:function(){if(!window.location.search.length){return{};}
return $.parseQuery();},getPageData:function(key){const data=window.analyticsPageData[this.code];if(data===undefined){return;}
return key!==undefined?data[key]:data;},getProductData:function(id){return this.getPageData()&&this.getPageData().products[id];},getCategoryData:function(){return this.getPageData()?.category;}});});