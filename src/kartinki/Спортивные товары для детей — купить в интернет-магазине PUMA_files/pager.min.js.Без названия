define(['uiComponent','ko','jquery','mage/apply/scripts','Magento_Theme/js/action/pager','gga.event.viewItemList','js/gga/ga4CustomEvent',],function(Component,ko,$,processScripts,pagerAction,viewItemList,ga4CustomEvent,){var $window=$(window)
return Component.extend({initialize:function(){this._super()
this.inProgressLoadMore=ko.observable(false)
this.isLoadAll=ko.observable(false)
$(document).on('catalog:update',function(){this.isLoadAll(false)}.bind(this))},rendered:function(element){this.$element=$(element)},loadMore:function(url,component,ev){const headerTitle=document.querySelector('h1.page-title')?.innerText||'';if(ev){ev.preventDefault();ga4CustomEvent('show_more_all',{item_list_id:headerTitle,item_list_name:headerTitle,});}else{ga4CustomEvent('show_more_all',{item_list_id:`Show All ${headerTitle}`,item_list_name:`Show All ${headerTitle}`,});}
this.inProgressLoadMore(true);$.when(pagerAction.load(url,this.$element)).done(function(){this.inProgressLoadMore(false);setTimeout(()=>{if(window.analyticsPageData&&window.analyticsPageData.category&&window.analyticsPageData.category.products&&typeof window.analyticsPageData.category.products==="object"){viewItemList({products:window.analyticsPageData.category.products});}},0);}.bind(this))},loadAll:function(url,component,ev){ev.preventDefault();this.isLoadAll(true)
this.loadMore(url,component)
this.scrollGrid()},scrollGrid:function(){$window.on('scroll.grid',function(){var needLoad=$window.scrollTop()>this.$element.offset().top-$window.height(),url=$(this.moreBtn).attr('href')
if(url===undefined){$window.off('scroll.grid')
return}
if(this.inProgressLoadMore()||!needLoad||this.isCurrentPage(url)){return}
this.loadMore(url)}.bind(this))},isCurrentPage:function(url){var pageParams=window.location.search!==''?$.parseQuery(window.location.search):{p:1},urlParams=url.split('?')[1]!==undefined?$.parseQuery(url.split('?')[1]):{p:1}
return urlParams.p===pageParams.p}})})