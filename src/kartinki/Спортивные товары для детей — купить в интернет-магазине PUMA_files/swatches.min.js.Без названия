define(['uiElement','ko','jquery','slick'],function(Component,ko,$){return Component.extend({settings:{product:'[data-product-card]',image:'[data-product-image]',link:'[data-swatch-link]',price:'[data-product-price]',stateOnlineFrom:'[data-state-online-from]',isComingSoonClass:'_is-coming-soon',isSoldOutClass:'_is-sold-out',count:4,speed:350},initialize:function(){this._super()
this.timer=null
this.lastProductSku=null},rendered:function(element){this.cache(element)
this.hoverSwatch()
this.initSlider()},cache:function(element){this.$element=$(element)},hoverSwatch:function(){this.$element.find(this.settings.link).hover(function(ev){if(this.lastProductSku===this.getProductSku(ev)){clearTimeout(this.timer)}
this.switchColor(ev,false)}.bind(this),function(ev){this.lastProductSku=this.getProductSku(ev)
this.timer=setTimeout(function(){this.switchColor(ev,true)}.bind(this),200)}.bind(this))},switchColor:function(ev,isOriginal){var $swatch=$(ev.currentTarget),$product=$swatch.closest(this.settings.product),$image=$product.find(this.settings.image),$price=$product.find(this.settings.price),$stateOnlineFrom=$product.find(this.settings.stateOnlineFrom),$labelBlock=$product.find('.product-item__label-text')
if(isOriginal){$image.attr('src',$image.data('original'))
$price.html($price.data('original'))
$stateOnlineFrom.text($stateOnlineFrom.data('online-from'))
$product.removeClass(this.settings.isComingSoonClass).removeClass(this.settings.isSoldOutClass).addClass($product.data('original-state'))
$swatch=$product.find('[alt="'+$product.data('product-sku')+'"]').first().closest('.swatches-item__link')
this.setDiscountLabel($labelBlock,$swatch)
return}
this.setOriginal($image,$price)
$image.attr('src',$swatch.data('preview'))
$price.html($swatch.data('price-html'))
$stateOnlineFrom.text($swatch.data('online-from'))
$product.toggleClass(this.settings.isComingSoonClass,!!$swatch.data('is-coming-soon')).toggleClass(this.settings.isSoldOutClass,!!$swatch.data('is-sold-out'))
this.setDiscountLabel($labelBlock,$swatch)},setDiscountLabel:function($labelBlock,$swatch){let $discount=$swatch.find('.swatches-item__img').data('discount-percent')
if($labelBlock.hasClass('product-item__label-discount')){if($discount!==0){$labelBlock.parent().show()
$labelBlock.text('-'+$discount+'%')}else{$labelBlock.parent().hide()}}},setOriginal:function($image,$price){if(!$image.data('original')){$image.data('original',$image.attr('src'))}
if(!$price.data('original')){$price.data('original',$price.html())}},getProductSku:function(ev){return $(ev.currentTarget).closest(this.settings.product).data('product-sku')},initSlider:function(){var $slider=this.$element;if($slider.children().length<=this.settings.count){return}
new IntersectionObserver(function(entries,observer){var isIntersecting=entries.find(function(entry){return entry.isIntersecting;});if(!isIntersecting){return;}
observer.disconnect();$slider.slick({speed:this.settings.speed,slidesToShow:this.settings.count,slidesToScroll:this.settings.count})}.bind(this)).observe($slider[0]);}})})